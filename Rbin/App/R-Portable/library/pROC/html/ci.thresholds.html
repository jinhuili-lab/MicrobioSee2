<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><title>R: Compute the confidence interval of thresholds</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link rel="stylesheet" type="text/css" href="R.css" />
</head><body><div class="container">

<table width="100%" summary="page for ci.thresholds {pROC}"><tr><td>ci.thresholds {pROC}</td><td style="text-align: right;">R Documentation</td></tr></table>

<h2>
Compute the confidence interval of thresholds
</h2>

<h3>Description</h3>

<p>This function computes the confidence interval (CI) of the sensitivity
and specificity of the thresholds given in argument.
By default, the 95% CI are computed with 2000 stratified bootstrap replicates.
</p>


<h3>Usage</h3>

<pre>
# ci.thresholds(...)
## S3 method for class 'roc'
ci.thresholds(roc, conf.level=0.95, boot.n=2000,
boot.stratified=TRUE, thresholds = "local maximas",
progress=getOption("pROCProgress")$name, parallel=FALSE, ...) 
## S3 method for class 'formula'
ci.thresholds(formula, data, ...)
## S3 method for class 'smooth.roc'
ci.thresholds(smooth.roc, ...)
## Default S3 method:
ci.thresholds(response, predictor, ...)
</pre>


<h3>Arguments</h3>

<table summary="R argblock">
<tr valign="top"><td><code>roc</code></td>
<td>
<p>a &ldquo;roc&rdquo; object from the <code><a href="../../pROC/help/roc.html">roc</a></code> function.</p>
</td></tr>
<tr valign="top"><td><code>smooth.roc</code></td>
<td>
<p>not available for <a href="../../pROC/help/smooth.roc.html">smoothed</a> ROC
curves, available only to catch the error and provide a clear error
message.
</p>
</td></tr>
<tr valign="top"><td><code>response, predictor</code></td>
<td>
<p>arguments for the <code><a href="../../pROC/help/roc.html">roc</a></code> function.</p>
</td></tr>
<tr valign="top"><td><code>formula, data</code></td>
<td>
<p>a formula (and possibly a data object) of type
response~predictor for the <code><a href="../../pROC/help/roc.html">roc</a></code> function.
</p>
</td></tr>
<tr valign="top"><td><code>conf.level</code></td>
<td>
<p>the width of the confidence interval as [0,1], never
in percent. Default: 0.95, resulting in a 95% CI.
</p>
</td></tr>
<tr valign="top"><td><code>boot.n</code></td>
<td>
<p>the number of bootstrap replicates. Default: 2000.</p>
</td></tr>
<tr valign="top"><td><code>boot.stratified</code></td>
<td>
<p>should the bootstrap be stratified (default, same number
of cases/controls in each replicate than in the original sample) or
not.
</p>
</td></tr>
<tr valign="top"><td><code>thresholds</code></td>
<td>
<p>on which thresholds to evaluate the CI. Either the
numeric values of the thresholds, a logical vector (as index of
<code>roc$thresholds</code>) or a character &ldquo;all&rdquo;, &ldquo;local
maximas&rdquo; or &ldquo;best&rdquo; that will be used to determine the threshold(s) 
on the supplied curve with <code><a href="../../pROC/help/coords.html">coords</a></code> (not on the resampled curves).
</p>
</td></tr>
<tr valign="top"><td><code>progress</code></td>
<td>
<p>the name of progress bar to display. Typically
&ldquo;none&rdquo;, &ldquo;win&rdquo;, &ldquo;tk&rdquo; or &ldquo;text&rdquo; (see the
<code>name</code> argument to <code><a href="../../plyr/help/create_progress_bar.html">create_progress_bar</a></code> for
more information), but a list as returned by <code><a href="../../plyr/help/create_progress_bar.html">create_progress_bar</a></code>
is also accepted. See also the &ldquo;Progress bars&rdquo; section of
<a href="../../pROC/help/pROC-package.html">this package's documentation</a>.
</p>
</td></tr>
<tr valign="top"><td><code>parallel</code></td>
<td>
<p>if TRUE, the bootstrap is processed in parallel, using 
parallel backend provided by plyr (foreach).
</p>
</td></tr>
<tr valign="top"><td><code>...</code></td>
<td>
<p>further arguments passed to or from other methods,
especially arguments for <code><a href="../../pROC/help/roc.html">roc</a></code> and <code>ci.thresholds.roc</code>
when calling <code>ci.thresholds.default</code> or <code>ci.thresholds.formula</code>.
Arguments for <code><a href="../../utils/html/txtProgressBar.html">txtProgressBar</a></code> (only 
<code>char</code> and <code>style</code>) if applicable. 
Arguments <code>best.method</code> and <code>best.weights</code> to <code><a href="../../pROC/help/coords.html">coords</a></code>.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>ci.thresholds.formula</code> and <code>ci.thresholds.default</code> are convenience methods
that build the ROC curve (with the <code><a href="../../pROC/help/roc.html">roc</a></code> function) before
calling <code>ci.thresholds.roc</code>. You can pass them arguments for both
<code><a href="../../pROC/help/roc.html">roc</a></code> and <code>ci.thresholds.roc</code>. Simply use <code>ci.thresholds</code>
that will dispatch to the correct method.
</p>
<p>This function creates <code>boot.n</code> bootstrap replicate of the ROC
curve, and evaluates the sensitivity and specificity at thresholds
given by the <code>thresholds</code> argument. Then it computes the
confidence interval as the percentiles given by <code>conf.level</code>.
</p>
<p>A threshold given as a <code>logical</code> vector or <code>character</code> is converted to the corresponding numeric vector once
<em>using the supplied ROC curve</em>, and not at each bootstrap iteration. See <code><a href="../../pROC/help/ci.coords.html">ci.coords</a></code> for the latter behaviour.
</p>
<p>For more details about the bootstrap, see the Bootstrap section in
<a href="../../pROC/help/pROC-package.html">this package's documentation</a>.
</p>


<h3>Value</h3>

<p>A list of length 2 and class &ldquo;ci.thresholds&rdquo;, &ldquo;ci&rdquo; and &ldquo;list&rdquo; (in this order), with the confidence
intervals of the CI and the following items:
</p>
<table summary="R valueblock">
<tr valign="top"><td><code>specificity</code></td>
<td>
<p>a matrix of CI for the specificity. Row (names) are the
thresholds, the first column the lower bound, the 2nd column the
median and the 3rd column the upper bound.
</p>
</td></tr>
<tr valign="top"><td><code>sensitivity</code></td>
<td>
<p>same than specificity.</p>
</td></tr>
</table>
<p>Additionally, the list has the following attributes: 
</p>
<table summary="R valueblock">
<tr valign="top"><td><code>conf.level</code></td>
<td>
<p>the width of the CI, in fraction.</p>
</td></tr>
<tr valign="top"><td><code>boot.n</code></td>
<td>
<p>the number of bootstrap replicates.</p>
</td></tr>
<tr valign="top"><td><code>boot.stratified</code></td>
<td>
<p>whether or not the bootstrapping was stratified.</p>
</td></tr>
<tr valign="top"><td><code>thresholds</code></td>
<td>
<p>the thresholds, as given in argument.</p>
</td></tr>
<tr valign="top"><td><code>roc</code></td>
<td>
<p>the object of class &ldquo;<a href="../../pROC/help/roc.html">roc</a>&rdquo; that was used to
compute the CI.
</p>
</td></tr>
</table>


<h3>Warnings</h3>

<p>If <code>boot.stratified=FALSE</code> and the sample has a large imbalance between
cases and controls, it could happen that one or more of the replicates
contains no case or control observation, producing a <code>NA</code> area.
The warning &ldquo;NA value(s) produced during bootstrap were ignored.&rdquo;
will be issued and the observation will be ignored. If you have a large
imbalance in your sample, it could be safer to keep
<code>boot.stratified=TRUE</code>.
</p>


<h3>References</h3>

<p>James Carpenter and John Bithell (2000) &ldquo;Bootstrap condence intervals:
when, which, what? A practical guide for medical statisticians&rdquo;.
<em>Statistics in Medicine</em> <b>19</b>, 1141&ndash;1164.
DOI: doi: <a href="https://doi.org/10.1002/(SICI)1097-0258(20000515)19:9%3C1141::AID-SIM479%3E3.0.CO;2-F">10.1002/(SICI)1097-0258(20000515)19:9&lt;1141::AID-SIM479&gt;3.0.CO;2-F</a>.
</p>
<p>Tom Fawcett (2006) &ldquo;An introduction to ROC analysis&rdquo;. <em>Pattern
Recognition Letters</em> <b>27</b>, 861&ndash;874. DOI:
doi: <a href="https://doi.org/10.1016/j.patrec.2005.10.010">10.1016/j.patrec.2005.10.010</a>.
</p>
<p>Xavier Robin, Natacha Turck, Alexandre Hainard, <em>et al.</em>
(2011) &ldquo;pROC: an open-source package for R and S+ to analyze and
compare ROC curves&rdquo;. <em>BMC Bioinformatics</em>, <b>7</b>, 77.
DOI: doi: <a href="https://doi.org/10.1186/1471-2105-12-77">10.1186/1471-2105-12-77</a>.
</p>
<p>Hadley Wickham (2011) &ldquo;The Split-Apply-Combine Strategy for Data Analysis&rdquo;. <em>Journal of Statistical Software</em>, <b>40</b>, 1&ndash;29.
URL: <a href="https://www.jstatsoft.org/v40/i01">www.jstatsoft.org/v40/i01</a>.
</p>


<h3>See Also</h3>

<p><code><a href="../../pROC/help/roc.html">roc</a></code>,
<code><a href="../../pROC/help/ci.html">ci</a></code>
</p>


<h3>Examples</h3>

<pre>
data(aSAH)

# Create a ROC curve:
data(aSAH)
roc1 &lt;- roc(aSAH$outcome, aSAH$s100b)


## Basic example ##
# Compute CI of all local maxima thresholds
## Not run: 
ci.thresholds(roc1)
## End(Not run)


## More options ##
# Customized bootstrap and thresholds:
## Not run: 
ci.thresholds(roc1,
			  thresholds=c(0.5, 1, 2),
              boot.n=10000, conf.level=0.9, stratified=FALSE)
## End(Not run)


## Plotting the CI ##
## Not run: 
ci1 &lt;- ci.thresholds(roc1)
## End(Not run)
plot(roc1)
plot(ci1)
</pre>

<hr /><div style="text-align: center;">[Package <em>pROC</em> version 1.18.0 <a href="00Index.html">Index</a>]</div>
</div></body></html>
