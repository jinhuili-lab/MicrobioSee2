<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><title>R: Nonlinear Least Squares Fit for OSL surface exposure data</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link rel="stylesheet" type="text/css" href="R.css" />
</head><body><div class="container">

<table width="100%" summary="page for fit_SurfaceExposure {Luminescence}"><tr><td>fit_SurfaceExposure {Luminescence}</td><td style="text-align: right;">R Documentation</td></tr></table>

<h2>Nonlinear Least Squares Fit for OSL surface exposure data</h2>

<h3>Description</h3>

<p>This function determines the (weighted) least-squares estimates of the
parameters of either equation 1 in <em>Sohbati et al. (2012a)</em> or equation 12 in
<em>Sohbati et al. (2012b)</em> for a given OSL surface exposure data set (<strong>BETA</strong>).
</p>


<h3>Usage</h3>

<pre>
fit_SurfaceExposure(
  data,
  sigmaphi = NULL,
  mu = NULL,
  age = NULL,
  Ddot = NULL,
  D0 = NULL,
  weights = FALSE,
  plot = TRUE,
  legend = TRUE,
  error_bars = TRUE,
  coord_flip = FALSE,
  ...
)
</pre>


<h3>Arguments</h3>

<table summary="R argblock">
<tr valign="top"><td><code>data</code></td>
<td>
<p><a href="../../base/html/data.frame.html">data.frame</a> or <a href="../../base/html/list.html">list</a> (<strong>required</strong>):
Measured OSL surface exposure data with the following structure:</p>
<pre>                               (optional)
     | depth (a.u.)| intensity | error |
     |     [ ,1]   |    [ ,2]  | [ ,3] |
     |-------------|-----------|-------|
[1, ]|    ~~~~     |    ~~~~   | ~~~~  |
[2, ]|    ~~~~     |    ~~~~   | ~~~~  |
 ... |     ...     |     ...   |  ...  |
[x, ]|    ~~~~     |    ~~~~   | ~~~~  |

</pre>
<p>Alternatively, a <a href="../../base/html/list.html">list</a> of <code>data.frames</code> can be provided, where each
<code>data.frame</code> has the same structure as shown above, with the exception that
they must <strong>not</strong> include the optional error column. Providing a <a href="../../base/html/list.html">list</a> as
input automatically activates the global fitting procedure (see details).</p>
</td></tr>
<tr valign="top"><td><code>sigmaphi</code></td>
<td>
<p><a href="../../base/html/numeric.html">numeric</a> (<em>optional</em>):
A numeric value for <code>sigmaphi</code>, i.e. the charge detrapping rate.
Example: <code>sigmaphi = 5e-10</code></p>
</td></tr>
<tr valign="top"><td><code>mu</code></td>
<td>
<p><a href="../../base/html/numeric.html">numeric</a> (<em>optional</em>):
A numeric value for mu, i.e. the light attenuation coefficient.
Example: <code>mu = 0.9</code></p>
</td></tr>
<tr valign="top"><td><code>age</code></td>
<td>
<p><a href="../../base/html/numeric.html">numeric</a> (<em>optional</em>):
The age (a) of the sample, if known. If <code>data</code> is a <a href="../../base/html/list.html">list</a> of <em>x</em> samples,
then <code>age</code> must be a numeric vector of length <em>x</em>.
Example: <code>age = 10000</code>, or <code>age = c(1e4, 1e5, 1e6)</code>.</p>
</td></tr>
<tr valign="top"><td><code>Ddot</code></td>
<td>
<p><a href="../../base/html/numeric.html">numeric</a> (<em>optional</em>):
A numeric value for the environmental dose rate (Gy/ka). For this argument
to be considered a value for <code>D0</code> must also be provided; otherwise it will be
ignored.</p>
</td></tr>
<tr valign="top"><td><code>D0</code></td>
<td>
<p><a href="../../base/html/numeric.html">numeric</a> (<em>optional</em>):
A numeric value for the characteristic saturation dose (Gy). For this argument
to be considered a value for <code>Ddot</code> must also be provided; otherwise it will be
ignored.</p>
</td></tr>
<tr valign="top"><td><code>weights</code></td>
<td>
<p><a href="../../base/html/logical.html">logical</a> (<em>optional</em>):
If <code>TRUE</code> the fit will be weighted by the inverse square of the error.
Requires <code>data</code> to be a <a href="../../base/html/data.frame.html">data.frame</a> with three columns.</p>
</td></tr>
<tr valign="top"><td><code>plot</code></td>
<td>
<p><a href="../../base/html/logical.html">logical</a> (<em>optional</em>):
Show or hide the plot.</p>
</td></tr>
<tr valign="top"><td><code>legend</code></td>
<td>
<p><a href="../../base/html/logical.html">logical</a> (<em>optional</em>):
Show or hide the equation inside the plot.</p>
</td></tr>
<tr valign="top"><td><code>error_bars</code></td>
<td>
<p><a href="../../base/html/logical.html">logical</a> (<em>optional</em>):
Show or hide error bars (only applies if errors were provided).</p>
</td></tr>
<tr valign="top"><td><code>coord_flip</code></td>
<td>
<p><a href="../../base/html/logical.html">logical</a> (<em>optional</em>):
Flip the coordinate system.</p>
</td></tr>
<tr valign="top"><td><code>...</code></td>
<td>
<p>Further parameters passed to <a href="../../graphics/html/plot.default.html">plot</a>.
Custom parameters include:
</p>

<ul>
<li> <p><code>verbose</code> (<a href="../../base/html/logical.html">logical</a>): show or hide console output
</p>
</li>
<li> <p><code>line_col</code>: Colour of the fitted line
</p>
</li>
<li> <p><code>line_lty</code>: Type of the fitted line (see <code>lty</code> in <code>?par</code>)
</p>
</li>
<li> <p><code>line_lwd</code>: Line width of the fitted line (see <code>lwd</code> in <code>?par</code>)
</p>
</li></ul>
</td></tr>
</table>


<h3>Details</h3>

<p><strong>Weighted fitting</strong>
</p>
<p>If <code>weights = TRUE</code> the function will use the inverse square of the error (<i>1/&sigma;^2</i>)
as weights during fitting using <a href="../../minpack.lm/help/nlsLM.html">minpack.lm::nlsLM</a>. Naturally, for this to
take effect individual errors must be provided in the third column of the
<code>data.frame</code> for <code>data</code>. Weighted fitting is <strong>not</strong> supported if <code>data</code>
is a list of multiple <code>data.frame</code>s, i.e., it is not available for global
fitting.
</p>
<p><strong>Dose rate</strong>
</p>
<p>If any of the arguments <code>Ddot</code> or <code>D0</code> is at its default value (<code>NULL</code>),
this function will fit equation 1 in Sohbati et al. (2012a) to the data. If
the effect of dose rate (i.e., signal saturation) needs to be considered,
numeric values for the dose rate (<code>Ddot</code>) (in Gy/ka) and the characteristic
saturation dose (<code>D0</code>) (in Gy) must be provided. The function will then fit
equation 12 in Sohbati et al. (2012b) to the data.
</p>
<p><strong>NOTE</strong>: Currently, this function does <strong>not</strong> consider the variability
of the dose rate with sample depth (<code>x</code>)! In the original equation the dose
rate <code>D</code> is an arbitrary function of <code>x</code> (term <code>D(x)</code>), but here <code>D</code> is assumed
constant.
</p>
<p><strong>Global fitting</strong>
</p>
<p>If <code>data</code> is <a href="../../base/html/list.html">list</a> of multiple <code>data.frame</code>s, each representing a separate
sample, the function automatically performs a global fit to the data. This
may be useful to better constrain the parameters <code>sigmaphi</code> or <code>mu</code> and
<strong>requires</strong> that known ages for each sample is provided
(e.g., <code>age = c(100, 1000)</code> if <code>data</code> is a list with two samples).
</p>


<h3>Value</h3>

<p>Function returns results numerically and graphically:
</p>
<p>&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&ndash;<br />
<code style="white-space: pre;">[ NUMERICAL OUTPUT ]</code><br />
&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&ndash;<br />
</p>
<p><strong><code>RLum.Results</code></strong>-object
</p>
<p><strong>slot:</strong> <strong><code style="white-space: pre;">@data</code></strong>
</p>

<table summary="Rd table">
<tr>
 <td style="text-align: left;">
<strong>Element</strong> </td><td style="text-align: left;"> <strong>Type</strong> </td><td style="text-align: left;"> <strong>Description</strong></td>
</tr>
<tr>
 <td style="text-align: left;">
<code style="white-space: pre;">$summary</code> </td><td style="text-align: left;"> <code>data.frame</code> </td><td style="text-align: left;"> summary of the fitting results </td>
</tr>
<tr>
 <td style="text-align: left;">
<code style="white-space: pre;">$data</code> </td><td style="text-align: left;"> <code>data.frame</code> </td><td style="text-align: left;"> the original input data </td>
</tr>
<tr>
 <td style="text-align: left;">
<code style="white-space: pre;">$fit</code> </td><td style="text-align: left;"> <code>nls</code> </td><td style="text-align: left;"> the fitting object produced by <a href="../../minpack.lm/help/nlsLM.html">minpack.lm::nlsLM</a> </td>
</tr>
<tr>
 <td style="text-align: left;">
<code style="white-space: pre;">$args</code> </td><td style="text-align: left;"> <code>character</code> </td><td style="text-align: left;"> arguments of the call </td>
</tr>
<tr>
 <td style="text-align: left;">
<code style="white-space: pre;">$call</code> </td><td style="text-align: left;"> <code>call</code> </td><td style="text-align: left;"> the original function call </td>
</tr>
<tr>
 <td style="text-align: left;">
</td>
</tr>

</table>

<p><strong>slot:</strong> <strong><code style="white-space: pre;">@info</code></strong>
</p>
<p>Currently unused.
</p>
<p>&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;<br />
<code style="white-space: pre;">[ PLOT OUTPUT ]</code><br />
&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;<br />
</p>
<p>A scatter plot of the provided depth-intensity OSL surface exposure data
with the fitted model.
</p>


<h3>Function version</h3>

<p>0.1.0
</p>


<h3>How to cite</h3>

<p>Burow, C., 2021. fit_SurfaceExposure(): Nonlinear Least Squares Fit for OSL surface exposure data. Function version 0.1.0. In: Kreutzer, S., Burow, C., Dietze, M., Fuchs, M.C., Schmidt, C., Fischer, M., Friedrich, J., Mercier, N., Philippe, A., Riedesel, S., Autzen, M., Mittelstrass, D., Gray, H.J., 2021. Luminescence: Comprehensive Luminescence Dating Data Analysis. R package version 0.9.15. https://CRAN.R-project.org/package=Luminescence
</p>


<h3>Note</h3>

<p><strong>This function has BETA status. If possible, results should be</strong>
<strong>cross-checked.</strong>
</p>


<h3>Author(s)</h3>

<p>Christoph Burow, University of Cologne (Germany)
, RLum Developer Team</p>


<h3>References</h3>

<p>Sohbati, R., Murray, A.S., Chapot, M.S., Jain, M., Pederson, J., 2012a.
Optically stimulated luminescence (OSL) as a chronometer for surface exposure
dating. Journal of Geophysical Research 117, B09202. doi: <a href="https://doi.org/10.1029/2012JB009383">10.1029/2012JB009383</a>
</p>
<p>Sohbati, R., Jain, M., Murray, A.S., 2012b. Surface exposure dating of
non-terrestrial bodies using optically stimulated luminescence: A new method.
Icarus 221, 160-166.
</p>


<h3>See Also</h3>

<p><a href="../../Luminescence/help/ExampleData.SurfaceExposure.html">ExampleData.SurfaceExposure</a>, <a href="../../minpack.lm/help/nlsLM.html">minpack.lm::nlsLM</a>
</p>


<h3>Examples</h3>

<pre>

## Load example data
data("ExampleData.SurfaceExposure")

## Example 1 - Single sample
# Known parameters: 10000 a, mu = 0.9, sigmaphi = 5e-10
sample_1 &lt;- ExampleData.SurfaceExposure$sample_1
head(sample_1)
results &lt;- fit_SurfaceExposure(sample_1, mu = 0.9, sigmaphi = 5e-10)
get_RLum(results)


## Example 2 - Single sample and considering dose rate
# Known parameters: 10000 a, mu = 0.9, sigmaphi = 5e-10,
# dose rate = 2.5 Gy/ka, D0 = 40 Gy
sample_2 &lt;- ExampleData.SurfaceExposure$sample_2
head(sample_2)
results &lt;- fit_SurfaceExposure(sample_2, mu = 0.9, sigmaphi = 5e-10,
                               Ddot = 2.5, D0 = 40)
get_RLum(results)


## Example 3 - Multiple samples (global fit) to better constrain 'mu'
# Known parameters: ages = 1e3, 1e4, 1e5, 1e6 a, mu = 0.9, sigmaphi = 5e-10
set_1 &lt;- ExampleData.SurfaceExposure$set_1
str(set_1, max.level = 2)
results &lt;- fit_SurfaceExposure(set_1, age = c(1e3, 1e4, 1e5, 1e6),
                               sigmaphi = 5e-10)
get_RLum(results)


## Example 4 - Multiple samples (global fit) and considering dose rate
# Known parameters: ages = 1e2, 1e3, 1e4, 1e5, 1e6 a, mu = 0.9, sigmaphi = 5e-10,
# dose rate = 1.0 Ga/ka, D0 = 40 Gy
set_2 &lt;- ExampleData.SurfaceExposure$set_2
str(set_2, max.level = 2)
results &lt;- fit_SurfaceExposure(set_2, age = c(1e2, 1e3, 1e4, 1e5, 1e6),
                               sigmaphi = 5e-10, Ddot = 1, D0 = 40)
get_RLum(results)

</pre>

<hr /><div style="text-align: center;">[Package <em>Luminescence</em> version 0.9.15 <a href="00Index.html">Index</a>]</div>
</div></body></html>
